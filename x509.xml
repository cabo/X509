<?xml version='1.0' encoding='ascii'?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc toc="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc comments="yes"?>
<rfc ipr="trust200902" docName="draft-schaad-cose-x509-00" category="info" obsoletes="" updates="" submissionType="IETF" xml:lang="en">
  <front>
    <title abbrev="COSE X.509">CBOR Encoded Message Syntax (COSE): Headers for carrying and referencing X.509 certificates</title>
    <author initials="J." surname="Schaad" fullname="Jim Schaad">
      <organization>August Cellars</organization>
      <address>
        <email>ietf@augustcellars.com</email>
      </address>
    </author>
    <date/>
    <area>Security</area>
    <abstract>
      <t>This document defines the headers and usage for  referring to and transporting X.509 certificates  in the CBOR Encoded Message (COSE) Syntax.  </t>
    </abstract>
    <note title="Contributing to this document">
      <!--RFC EDITOR - Please remove this note before publishing -->
      <t>The source for this draft is being maintained in GitHub.  Suggested changes should be submitted as pull requests  at <eref target="https://github.com/cose-wg/X509"/>.  Instructions are on that page as well.  Editorial changes can be managed in GitHub, but any substantial issues need to be discussed on the COSE mailing list.  </t>
    </note>
  </front>
  <middle>
    <section anchor="introduction" title="Introduction" numbered="yes" toc="default">
      <t>In the process of writing RFCXXXX <xref target="I-D.ietf-cose-msg" pageno="false" format="default"/> discussions where held on the question of X.509 certificates  <xref target="RFC5280" pageno="false" format="default"/>  and if there were needed.  At the time there were no use cases presented that appeared to hve a sufficient set of support to include these headers.  Since that time a number of cases where X.509 certificate support is necessary have been defined.  This document provides a set of headers that will allow applications to transport and refer to X.509 certificates in a consistent manner.  </t>
      <section anchor="requirements-terminology" title="Requirements Terminology" numbered="yes" toc="default">
        <!--NOTE FOR AUTHORS: We use the following terms in the document field - an entry in a CBOR array parameter - an element in a CBOR map (as oppose to 'member' which is frequently used in JSON label - the key of an element in a CBOR map.   Unless otherwise separated from text, enclose with single quote marks value - the value of an element in a CBOR map -->
        <t>The key words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;REQUIRED&#8221;, &#8220;SHALL&#8221;, &#8220;SHALL NOT&#8221;, &#8220;SHOULD&#8221;, &#8220;SHOULD NOT&#8221;, &#8220;RECOMMENDED&#8221;, &#8220;NOT RECOMMENDED&#8221;, &#8220;MAY&#8221;, and &#8220;OPTIONAL&#8221; in this document are to be interpreted as described in <xref target="RFC2119" pageno="false" format="default"/>.  </t>
        <t>When the words appear in lower case, their natural language meaning is used.  </t>
      </section>
    </section>
    <section title="X.509 COSE Headers" numbered="yes" toc="default">
      <t>The use of X.509 certificates allows for an existing trust infrastructure to be used with COSE.  </t>
      <t>When the header parameters defined in this section are placed in a COSE_Signature or COSE_Sign0 object, they identify the key that was used for generating signature.  </t>
      <t>When the header parameters defined in this section are placed in a COSE_recipient structure, they identify the key that was used by the sender when used with static-static key agreement algorithms.  </t>
      <t>Certificates obtained from any of these methods MUST still be validated according to the PKIX rules in <xref target="RFC5280" pageno="false" format="default"/>.  This includes matching against the trust anchors configured for the application.  This applies certificates of a chain length of one as well as longer chains.  </t>
      <t>The header parameters defined in this document are: <list style="hanging"><t hangText="x5c:">This header parameter allows for a single or a bag of X.509 certificates to be carried in the message.  <list style="symbols"><t>If a single certificate is conveyed, it is placed in a CBOR bstr.  </t><t>If multiple certificates are conveyed, a CBOR array is used where: <list style="symbols"><t>The first element is a boolean value set to true if the certificates are arranged such that a each certificate is issued by the next certficate.  In otherwords a chain of certificates is presented.  The chain of certificates does not need to be complete and normally SHOULD omit the trust anchor certificate.  If the first element is set to false, then the certificates are not ordered and can include certificates that are not needed to create a certificate chain from the end-entity certificate.  This allows for a certificate with a key exchange algorithm to be carried in a signed message.  </t><t>The second element is the end-entity certificate.  This is true regardless of wheither the certificates are ordered or not.  This permits the application to identify which certificate is the end-entity certificate without a second header attribute.  </t><t>Elements three through the last are certificates.  </t></list> </t></list> </t><t hangText="x5t:">This header parameter provides the ability to identify an X.509 certificate by a hash value.  The parameter is an array of two elements.  The first element is an algorithm identifier which is a signed integer, an unsigned integer or a string containing the hash algorithm identifier.  The second element is a binary string containing the hash value.  <vspace blankLines="0"/> For interoperability, applications which use this header parameter MUST support the hash algorithm 'sha256', but can use other hash algorithms.  </t><t hangText="x5u:">This header parameter provides the ability to identify an X.509 certificate by a URL.  The referenced resource can be any of the following media types: <list style="symbols"><t>application/pkix-cert <xref target="RFC2585" pageno="false" format="default"/></t><t>application/pkcs7-mime; smime-type="certs-only" <xref target="I-D.ietf-lamps-rfc5751-bis" pageno="false" format="default"/></t><t>Should we support a PEM type? I cannot find a registered media type for one</t></list> <vspace blankLines="0"/> The URL provided MUST provide integrity protection.  For example, an HTTP GET request to retrieve a certificate MUST use TLS <xref target="RFC5246" pageno="false" format="default"/>.  If the certificate does not chain to an existing trust anchor, the identity of the server MUST be configured as trusted to provide new trust anchors.  This will normally be the situation when self-signed certificates are used.  </t></list> </t>
      <texttable anchor="Tags" title="X.509 COSE Headers" suppress-title="false" align="center" style="full">
        <ttcol align="left">name</ttcol>
        <ttcol align="left">label</ttcol>
        <ttcol align="left">value type</ttcol>
        <ttcol align="left">description</ttcol>
        <c>x5t</c>
        <c>TBD1</c>
        <c>COSE_CertHash</c>
        <c>Hash of an X.509 certificate</c>
        <c>x5u</c>
        <c>TBD2</c>
        <c>uri</c>
        <c>URL pointing to an X.509 certificate</c>
        <c>x5c</c>
        <c>TBD3</c>
        <c>COSE_X509</c>
        <c>Collection of X.509 certificates</c>
      </texttable>
      <figure title="" suppress-title="false" align="left" alt="" width="" height="">
        <artwork type="CDDL" xml:space="preserve" name="" align="left" alt="" width="" height="">
COSE_X509 = bstr / [ ordered: bool, certs: +bstr ]
COSE_CertHash = [ hashAlg: (int / tstr), hashValue: bstr ]
</artwork>
      </figure>
    </section>
    <section title="Hash Algorithm Identifiers" numbered="yes" toc="default">
      <section title="SHA-2 256-bit Hash" numbered="yes" toc="default">
        <t>Define an algorithm identifier for SHA-256.  </t>
      </section>
    </section>
    <section anchor="iana-considerations" title="IANA Considerations" numbered="yes" toc="default">
      <section anchor="cose-header-key-table" title="COSE Header Parameter Registry" numbered="yes" toc="default">
        <t>Put in the registrations.  </t>
      </section>
      <section anchor="cose-algorithm-registry" title="COSE Algorithm Registry" numbered="yes" toc="default">
        <t>Put in the registrations.  </t>
      </section>
    </section>
    <section anchor="security-considerations" title="Security Considerations" numbered="yes" toc="default">
      <t>There are security considerations: </t>
    </section>
  </middle>
  <back>
    <references title="Normative References"><reference anchor="RFC2119" target="http://www.rfc-editor.org/info/rfc2119" quote-title="true"><front><title>Key words for use in RFCs to Indicate Requirement Levels</title><author initials="S." surname="Bradner" fullname="S. Bradner"><organization/></author><date year="1997" month="March"/><abstract><t>In many standards track documents several words are used to signify the requirements in the specification.  These words are often capitalized. This document defines these words as they should be interpreted in IETF documents.  This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t></abstract></front><seriesInfo name="BCP" value="14"/><seriesInfo name="RFC" value="2119"/><seriesInfo name="DOI" value="10.17487/RFC2119"/></reference> <reference anchor="RFC5280" target="http://www.rfc-editor.org/info/rfc5280" quote-title="true"><front><title>Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</title><author initials="D." surname="Cooper" fullname="D. Cooper"><organization/></author><author initials="S." surname="Santesson" fullname="S. Santesson"><organization/></author><author initials="S." surname="Farrell" fullname="S. Farrell"><organization/></author><author initials="S." surname="Boeyen" fullname="S. Boeyen"><organization/></author><author initials="R." surname="Housley" fullname="R. Housley"><organization/></author><author initials="W." surname="Polk" fullname="W. Polk"><organization/></author><date year="2008" month="May"/><abstract><t>This memo profiles the X.509 v3 certificate and X.509 v2 certificate revocation list (CRL) for use in the Internet.  An overview of this approach and model is provided as an introduction.  The X.509 v3 certificate format is described in detail, with additional information regarding the format and semantics of Internet name forms.  Standard certificate extensions are described and two Internet-specific extensions are defined.  A set of required certificate extensions is specified.  The X.509 v2 CRL format is described in detail along with standard and Internet-specific extensions.  An algorithm for X.509 certification path validation is described.  An ASN.1 module and examples are provided in the appendices.  [STANDARDS-TRACK]</t></abstract></front><seriesInfo name="RFC" value="5280"/><seriesInfo name="DOI" value="10.17487/RFC5280"/></reference> <reference anchor="RFC7049" target="http://www.rfc-editor.org/info/rfc7049" quote-title="true"><front><title>Concise Binary Object Representation (CBOR)</title><author initials="C." surname="Bormann" fullname="C. Bormann"><organization/></author><author initials="P." surname="Hoffman" fullname="P. Hoffman"><organization/></author><date year="2013" month="October"/><abstract><t>The Concise Binary Object Representation (CBOR) is a data format whose design goals include the possibility of extremely small code size, fairly small message size, and extensibility without the need for version negotiation.  These design goals make it different from earlier binary serializations such as ASN.1 and MessagePack.</t></abstract></front><seriesInfo name="RFC" value="7049"/><seriesInfo name="DOI" value="10.17487/RFC7049"/></reference> <reference anchor="I-D.ietf-cose-msg" quote-title="true"><front><title>CBOR Object Signing and Encryption (COSE)</title><author initials="J" surname="Schaad" fullname="Jim Schaad"><organization/></author><date month="October" day="18" year="2016"/><abstract><t>Concise Binary Object Representation (CBOR) is data format designed for small code size and small message size.  There is a need for the ability to have basic security services defined for this data format. This document defines the CBOR Object Signing and Encryption (COSE) specification.  This specification describes how to create and process signature, message authentication codes and encryption using CBOR for serialization.  This specification additionally specifies how to represent cryptographic keys using CBOR.</t></abstract></front><seriesInfo name="Internet-Draft" value="draft-ietf-cose-msg-23"/><format type="TXT" target="http://www.ietf.org/internet-drafts/draft-ietf-cose-msg-23.txt"/></reference> </references>
    <references title="Informative References"><reference anchor="I-D.greevenbosch-appsawg-cbor-cddl" quote-title="true"><front><title>CBOR data definition language (CDDL): a notational convention to express CBOR data structures</title><author initials="C" surname="Vigano" fullname="Christoph Vigano"><organization/></author><author initials="H" surname="Birkholz" fullname="Henk Birkholz"><organization/></author><date month="September" day="21" year="2016"/><abstract><t>This document proposes a notational convention to express CBOR data structures (RFC 7049).  Its main goal is to provide an easy and unambiguous way to express structures for protocol messages and data formats that use CBOR.</t></abstract></front><seriesInfo name="Internet-Draft" value="draft-greevenbosch-appsawg-cbor-cddl-09"/><format type="TXT" target="http://www.ietf.org/internet-drafts/draft-greevenbosch-appsawg-cbor-cddl-09.txt"/></reference> <reference anchor="RFC5246" target="http://www.rfc-editor.org/info/rfc5246" quote-title="true"><front><title>The Transport Layer Security (TLS) Protocol Version 1.2</title><author initials="T." surname="Dierks" fullname="T. Dierks"><organization/></author><author initials="E." surname="Rescorla" fullname="E. Rescorla"><organization/></author><date year="2008" month="August"/><abstract><t>This document specifies Version 1.2 of the Transport Layer Security (TLS) protocol.  The TLS protocol provides communications security over the Internet.  The protocol allows client/server applications to communicate in a way that is designed to prevent eavesdropping, tampering, or message forgery.  [STANDARDS-TRACK]</t></abstract></front><seriesInfo name="RFC" value="5246"/><seriesInfo name="DOI" value="10.17487/RFC5246"/></reference> <reference anchor="I-D.ietf-lamps-rfc5751-bis" quote-title="true"><front><title>Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 4.0 Message Specification</title><author initials="J" surname="Schaad" fullname="Jim Schaad"><organization/></author><author initials="B" surname="Ramsdell" fullname="Blake Ramsdell"><organization/></author><author initials="S" surname="Turner" fullname="Sean Turner"><organization/></author><date month="October" day="29" year="2016"/><abstract><t>This document defines Secure/Multipurpose Internet Mail Extensions (S/MIME) version 4.0.  S/MIME provides a consistent way to send and receive secure MIME data.  Digital signatures provide authentication, message integrity, and non-repudiation with proof of origin. Encryption provides data confidentiality.  Compression can be used to reduce data size.  This document obsoletes RFC 5751.</t></abstract></front><seriesInfo name="Internet-Draft" value="draft-ietf-lamps-rfc5751-bis-02"/><format type="TXT" target="http://www.ietf.org/internet-drafts/draft-ietf-lamps-rfc5751-bis-02.txt"/></reference> <reference anchor="RFC2585" target="http://www.rfc-editor.org/info/rfc2585" quote-title="true"><front><title>Internet X.509 Public Key Infrastructure Operational Protocols: FTP and HTTP</title><author initials="R." surname="Housley" fullname="R. Housley"><organization/></author><author initials="P." surname="Hoffman" fullname="P. Hoffman"><organization/></author><date year="1999" month="May"/><abstract><t>The protocol conventions described in this document satisfy some of the operational requirements of the Internet Public Key Infrastructure (PKI).  This document specifies the conventions for using the File Transfer Protocol (FTP) and the Hypertext Transfer Protocol (HTTP) to obtain certificates and certificate revocation lists (CRLs) from PKI repositories.  [STANDARDS-TRACK]</t></abstract></front><seriesInfo name="RFC" value="2585"/><seriesInfo name="DOI" value="10.17487/RFC2585"/></reference> </references>
  </back>
</rfc>
